name: Bore-RDP-Latest
on: workflow_dispatch

jobs:
  rdp:
    runs-on: windows-latest
    steps:
    - name: Setup Windows & User
      run: |
        # 1. Enable RDP and allow connections through firewall
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        
        # 2. Allow multiple sessions (fixes the "Console" session error)
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fSingleSessionPerUser" -Value 0
        
        # 3. Create user NoahNW with your password
        net user NoahNW "Iloveriley123$" /add
        net localgroup Administrators NoahNW /add

    - name: Download and Start Bore
      run: |
        # Download the v0.6.0 Bore tool you provided
        Invoke-WebRequest https://github.com/ekzhang/bore/releases/download/v0.6.0/bore-v0.6.0-x86_64-pc-windows-msvc.zip -OutFile bore.zip
        Expand-Archive bore.zip -DestinationPath .
        
        Write-Host "--- TUNNEL STARTING ---"
        # Connects local port 3389 to the public bore.pub server
        .\bore.exe local 3389 --to bore.pub
